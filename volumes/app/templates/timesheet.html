{% extends "base.html" %}



{% block title %}Zeiterfassung - {{ current_user.username }}{% endblock %}



{% block extra_css %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/timesheet.css') }}">

<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">

{% endblock %}



{% block nav_links %}

<a href="{{ url_for('summary') }}" class="nav-link">Zusammenfassung</a>

{% endblock %}



{% block content %}

<!-- Tickets Section at the top -->

<div class="tickets-grid">

    <!-- Stop/Pause Button as first ticket -->

    {% if current_entry_id %}

    <a href="{{ url_for('stop_timer') }}" class="ticket-btn" style="background-color: #1a7f37;">

        Stopp

    </a>

    {% else %}

    <div class="ticket-btn" style="background-color: #656d76; cursor: not-allowed; opacity: 0.6;">

        Stopp

    </div>

    {% endif %}

    

    <!-- Regular Tickets -->

    {% for ticket in tickets %}

    <div class="ticket-btn {% if current_entry_id %}{% for entry in entries %}{% if entry.id == current_entry_id and entry.ticket_name == ticket.name %}active{% endif %}{% endfor %}{% endif %}"

         style="background-color: {{ ticket.color }};">

        <a href="{{ url_for('start_timer', ticket_name=ticket.name) }}" 

           style="color: inherit; text-decoration: none; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">

            {{ ticket.name }}

        </a>

        <div class="ticket-actions">

            <button class="action-btn edit-ticket-btn" onclick="event.stopPropagation(); openEditTicketModal('{{ ticket.id }}')" title="Bearbeiten">✎</button>

            <button class="action-btn delete-ticket-btn" onclick="event.stopPropagation(); if(confirm('Ticket {{ ticket.name }} löschen?')) window.location.href='{{ url_for('delete_ticket', ticket_id=ticket.id) }}'" title="Löschen">×</button>

        </div>

    </div>

    {% endfor %}

    

    <!-- Add Button -->

    <div class="ticket-btn add-btn" onclick="openAddTicketModal()">

        +

    </div>

</div>



{% include 'components/_ticket_modal.html' %}



<!-- Current Timer Display -->

<div class="current-timer" id="currentTimer">

    {% if current_entry_id %}

        Timer läuft...

    {% else %}

        Bereit für neue Zeiterfassung

    {% endif %}

</div>



{% include 'components/_entry_table.html' %}

{% endblock %}



{% block extra_js %}

<script src="{{ url_for('static', filename='js/modal.js') }}"></script>

<script src="{{ url_for('static', filename='js/timer.js') }}"></script>

{% endblock %}
