{% extends "base.html" %}



{% block title %}Zeiterfassung - {{ current_user.username }}{% endblock %}



{% block extra_css %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/timesheet.css') }}">

<link rel="stylesheet" href="{{ url_for('static', filename='css/modal.css') }}">

{% endblock %}



 

{% block nav_links %}

<a href="{{ url_for('summary') }}" class="nav-link">ðŸ“Š Zusammenfassung</a>

{% endblock %}



{% block content %}



<!-- Tickets Section at the top -->

<div class="tickets-grid">

    <!-- Stop/Pause Button as first ticket -->

    {% if current_entry_id %}

    <a href="{{ url_for('stop_timer') }}" class="ticket-btn" style="background-color: #1a7f37;">

        Stopp

    </a>

    {% else %}

    <div class="ticket-btn" style="background-color: #656d76; cursor: not-allowed; opacity: 0.6;">

        Stopp

    </div>

    {% endif %}

    

    <!-- Regular Tickets - simplified structure for better drag & drop -->

    {% for ticket in tickets %}

    <div class="ticket-btn {% if current_entry_id %}{% for entry in entries %}{% if entry.id == current_entry_id and entry.ticket_name == ticket.name %}active{% endif %}{% endfor %}{% endif %}"

         style="background-color: {{ ticket.color }};"

         data-ticket-id="{{ ticket.id }}"

         draggable="true">



        <!-- Drag handle - optional, fÃ¼r visuellen Hinweis -->

        <div class="drag-handle" title="Ziehen zum Sortieren"></div>



        <!-- Klickbarer Link - gesamter Button auÃŸer Actions -->

        <a href="{{ url_for('start_timer', ticket_name=ticket.name) }}"

           style="color: inherit; text-decoration: none; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; padding-left: 24px;">

            {{ ticket.name }}

        </a>



        <!-- Action Buttons -->

        <div class="ticket-actions">

            <button class="action-btn edit-ticket-btn"

                    onclick="event.preventDefault(); event.stopPropagation(); openEditTicketModal('{{ ticket.id }}')"

                    title="Bearbeiten">âœŽ</button>

            <button class="action-btn delete-ticket-btn"

                    onclick="event.preventDefault(); event.stopPropagation(); if(confirm('Ticket {{ ticket.name }} lÃ¶schen?')) window.location.href='{{ url_for('delete_ticket', ticket_id=ticket.id) }}'"

                    title="LÃ¶schen">Ã—</button>

        </div>

    </div>

    {% endfor %}

    

    <!-- Add Button -->

    <div class="ticket-btn add-btn" onclick="openAddTicketModal()">

        +

    </div>

</div>



{% include 'components/_ticket_modal.html' %}



<!-- Current Timer Display -->

<div class="current-timer" id="currentTimer">

    {% if current_entry_id %}

        Timer lÃ¤uft...

    {% else %}

        Bereit fÃ¼r neue Zeiterfassung

    {% endif %}

</div>



{% include 'components/_entry_table.html' %}



{% endblock %}



{% block extra_js %}

<script src="{{ url_for('static', filename='js/modal.js') }}"></script>

<script src="{{ url_for('static', filename='js/timer.js') }}"></script>

<script src="{{ url_for('static', filename='js/drag-drop.js') }}"></script>

{% endblock %}
